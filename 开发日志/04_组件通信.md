下面详细说明`defineProps`和`defineEmits`在 Vue 3 中的用法，分别用 JavaScript 和 TypeScript 举例：

## defineProps

`defineProps`是 Vue 3 `<script setup>`语法中用于声明组件接收的属性。

### JavaScript 中的用法

**基本用法：**

```js
// 简单声明
const props = defineProps(["name", "age"]);

// 带验证的声明
const props = defineProps({
  name: String,
  age: {
    type: Number,
    required: true,
    default: 18,
  },
  address: {
    type: Object,
    validator(value) {
      return value.city && value.street;
    },
  },
});

console.log(props.name); // 访问属性
```

**带默认值：**

```js
const props = defineProps({
  level: {
    type: String,
    default: "info",
  },
  messages: {
    type: Array,
    default: () => [], // 对象或数组默认值必须从工厂函数获取
  },
});
```

### TypeScript 中的用法

**使用类型声明：**

```ts
// 使用类型参数声明
const props = defineProps<{
  name: string;
  age?: number; // 可选属性
  info: {
    address: string;
    phone: string;
  };
}>();
```

**带默认值的类型声明：**

```ts
// 使用withDefaults
interface Props {
  name: string;
  age?: number;
  tags?: string[];
}

const props = withDefaults(defineProps<Props>(), {
  age: 18,
  tags: () => ["默认标签"],
});
```

**结合接口：**

```ts
interface UserInfo {
  id: number;
  username: string;
  email: string;
}

const props = defineProps<{
  user: UserInfo;
  isAdmin?: boolean;
}>();
```

## defineEmits

`defineEmits`用于声明组件可以触发的事件。

### JavaScript 中的用法

**简单声明：**

```js
// 只声明事件名
const emit = defineEmits(["change", "update", "submit"]);

// 使用事件
function handleClick() {
  emit("change", "newValue");
}
```

**带验证的声明：**

```js
const emit = defineEmits({
  // 不带验证
  click: null,

  // 带验证函数
  submit: (payload) => {
    if (!payload.content) {
      console.warn("Missing content!");
      return false;
    }
    return true;
  },
});

// 使用
function submitForm(data) {
  emit("submit", { content: data.text });
}
```

### TypeScript 中的用法

**基本类型声明：**

```ts
// 简单声明
const emit = defineEmits<{
  (e: "change"): void;
  (e: "update", value: string): void;
}>();

// 使用
function updateValue(newVal: string) {
  emit("update", newVal);
}
```

**更简洁的语法：**

```ts
// Vue 3.3+支持的更简洁语法
const emit = defineEmits<{
  change: [];
  update: [value: string];
  submit: [payload: { content: string; id: number }];
}>();

// 使用
function handleSubmit() {
  emit("submit", { content: "Hello", id: 123 });
}
```

**结合自定义类型：**

```ts
interface UpdateEvent {
  id: number;
  value: string;
  timestamp: number;
}

const emit = defineEmits<{
  update: [payload: UpdateEvent];
  delete: [id: number];
}>();

function update(id: number, value: string) {
  emit("update", {
    id,
    value,
    timestamp: Date.now(),
  });
}
```

在您的 EstatesItem 组件中，您可以这样改进事件处理：

```ts
// 更详细的事件定义
const emit = defineEmits<{
  click: [id: number];
  favorite: [id: number, isFavorite: boolean];
  "view-details": [property: EstatesItem];
}>();

// 然后在组件中使用
function handleClick() {
  emit("click", props.property.id);
}

function toggleFavorite(event: Event) {
  event.stopPropagation(); // 阻止冒泡，避免触发handleClick
  emit("favorite", props.property.id, !isFavorite.value);
}

function viewDetails() {
  emit("view-details", props.property);
}
```

这样，父组件就可以监听这些事件并做出相应的处理。
